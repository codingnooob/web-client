<!DOCTYPE html>
<html>

<head>
  <!-- @import "app-head.kit" -->
  <title>Cryptee | Home</title>
</head>

<body class="home-body">



  <section class="hero is-fullheight">

    <div class="hero-head">
      <div class="home-header">

      </div>
      <div class="container">
        <nav class="level is-mobile">

          <div class="level-item level-left home-level-left">
            <div class="settings-tabs tabs is-small"> <!-- you can also make this is-centered -->
              <ul>
                <a class="nav-item" href="/"><img src="../assets/cryptee-logo-b.svg" alt="Cryptee logo"></a>
                <li title="Account Settings"> <a class="top-left-icon" href="account"><i class="top-menu-icons fa fa-fw fa-cog"></i></a></li>
                <li title="Sign Out"> <a class="top-left-icon" onclick="signOut();"><i class="top-menu-icons fa fa-fw fa-sign-out"></i></a></li>
              </ul>
            </div>
          </div>

        </nav>
      </div>

    </div>
    <div class="hero-body">
      <div class="container">
        <nav class="level home-title">
          <div class="level-item has-text-centered">
            <p class="subtitle">Welcome home, <span class="username" style="font-weight:600"></span>.<br> Looks like you are using <span id="settings-storage-used" style="font-weight:600"></span> of your <span style="font-weight:600" class="settings-storage-total"></span> storage.</p>
          </div>
        </nav>
        <br>
        <nav class="level">
          <div class="level-item has-text-centered">
            <a href="docs" class="home-item">
              <p class="heading"><span class="icon is-medium"><i class="top-menu-icons fa fa-fw fa-briefcase"></i></span></p>
              <p class="subtitle">Documents</p>
            </a>
            <a href="contacts" class="home-item">
              <p class="heading"><span class="icon is-medium"><i class="top-menu-icons fa fa-fw fa-address-book"></i></span></p>
              <p class="subtitle">Contacts</p>
            </a>
            <a href="photos" class="home-item">
              <p class="heading"><span class="icon is-medium"><i class="top-menu-icons fa fa-fw fa-camera"></i></span></p>
              <p class="subtitle">Photos</p>
            </a>
          </div>
        </nav>
      </div>
    </div>
    <div class="hero-foot">
      <nav class="level home-title">
        <div class="level-item has-text-centered">
          <p class="tag title is-6 is-light">not &nbsp;<span class="username"></span>?</p>
          <p class="tag title is-6 is-black clickable" onclick="signOut();">SIGN OUT</p>
        </div>
      </nav>
    </div>
  </section>

  <!-- @import "www-footer.kit" -->

  <script type="text/javascript">
  var theUser, theUsername, theEmail, metaRef, theUserID;

  function formatBytes(bytes,decimals) {
     if (bytes === 0) { return '0 Bytes'; }
     var k = 1000,
         dm = decimals + 1 || 3,
         sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'],
         i = Math.floor(Math.log(bytes) / Math.log(k));
     return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
  }

  firebase.auth().onAuthStateChanged(function(user) {
    if (!user) {
      window.location = "signin?redirect=home";
    } else {
      //got user
      theUser = user;
      theUsername = theUser.displayName;
      theEmail = theUser.email;
      theUserID = theUser.uid;
      metaRef = db.ref().child('/users/' + theUserID + "/meta/");
      gotUser();
    }
  });

  function gotUser() {
    $('.username').html(theUsername);
    metaRef.on('value', function(snapshot) {  gotUserMeta(snapshot.val());  });
  }



  function gotUserMeta (meta){

    usedStorage = meta.usedStorage || 0;
    $('#settings-storage-used').html(formatBytes(usedStorage, 0));

    allowedStorage = meta.allowedStorage || freeUserQuotaInBytes;
    $('.settings-storage-total').html(formatBytes(allowedStorage, 0));

    userPlan = meta.plan;
  }

  function signOut(){
    sessionStorage.removeItem('key');
    firebase.auth().signOut().then(function() {
      console.log('Signed Out');
    }, function(error) {
      console.error('Sign Out Error', error);
    });
  }
  </script>
</body></html>
